batching:
  realtime: {enabled: false}
  standard: {enabled: true, max_msgs: 128, max_bytes: "1MiB", linger_ms: 20}
  bulk:     {enabled: true, max_msgs: 1000, max_bytes: "16MiB", linger_ms: 100}

compression:
  threshold_bytes: 4096
  codec_order: ["zstd","gzip","none"]
  # Per-domain overrides
  overrides:
    intelligence: {threshold_bytes: 1024, codec_order: ["zstd"]}  # AI payloads compress well
    memory: {threshold_bytes: 8192, codec_order: ["gzip","none"]}  # Memory items vary

large_payloads:
  inline_threshold_bytes: 262144   # 256 KiB
  store: "fusion://blobs/"
  integrity: "sha256"
  # Automatic promotion rules
  auto_promote:
    - {content_type: "application/pdf", min_size: 65536}
    - {content_type: "audio/*", min_size: 1048576}
    - {content_type: "application/octet-stream", min_size: 524288}

# Payload optimization strategies
optimization:
  json_minification: true
  field_ordering: "alphabetical"  # consistent field order for better compression
  null_field_removal: true
  
  # Schema-specific optimizations
  schema_optimizations:
    "intelligence.result":
      - remove_null_confidence_fields
      - compress_embedding_vectors
    "mlt.experience":  
      - truncate_debug_fields
      - sample_metrics_arrays

# Performance monitoring
monitoring:
  track_compression_ratios: true
  track_serialization_time: true
  alert_on_large_payloads: true
  large_payload_threshold_mb: 5