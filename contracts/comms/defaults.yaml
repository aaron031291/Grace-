defaults:
  # Default partition key selection order
  partition_key_order:
    - correlation_id
    - entity_id
    - loop_id
    - domain

  # Payload size thresholds
  inline_payload_max_bytes: 262144  # 256 KiB
  large_payload_threshold_bytes: 1048576  # 1 MiB

  # Default compression settings
  compression: "zstd"
  compression_level: 3

  # Default retry configuration
  retries:
    exp_base_ms: 50
    max_attempts: 5
    jitter_ms: 40
    backoff_multiplier: 2.0

  # Default lane configuration
  lanes:
    P0: {partitions: 8, max_throughput_rps: 1000}
    P1: {partitions: 8, max_throughput_rps: 5000}
    P2: {partitions: 6, max_throughput_rps: 10000}
    P3: {partitions: 4, max_throughput_rps: 50000}

  # Dead letter queue settings
  dlq:
    enabled: true
    topic: "grace.dlq"
    retention_days: 7
    max_retries_before_dlq: 10

  # Default headers for all messages
  headers:
    version: "1.0.0"
    governance_label: "internal"
    compression: "none"
    priority: "P2"
    qos: "standard"

  # Default timeout values
  timeouts:
    publish_timeout_ms: 1000
    consumer_timeout_ms: 30000
    health_check_interval_ms: 10000

  # Schema validation
  validation:
    enforce_schemas: true
    allow_unknown_fields: false
    validate_on_publish: true
    validate_on_consume: false

  # Security defaults
  security:
    require_authentication: true
    require_authorization: true
    encrypt_sensitive_payloads: true
    audit_all_governance_events: true

  # Observability defaults  
  observability:
    trace_sampling_rate: 0.1
    enable_metrics: true
    log_level: "INFO"
    redact_pii_in_logs: true

  # Transport preferences (in priority order)
  preferred_transports:
    - "kafka"    # most reliable
    - "nats"     # fastest
    - "http"     # most compatible
    - "amqp"     # enterprise standard
    - "ws"       # real-time UI

  # Batching defaults
  batching:
    default_batch_size: 100
    max_batch_wait_ms: 50
    adaptive_batching: true

  # Circuit breaker defaults
  circuit_breaker:
    failure_threshold_percent: 50
    min_request_threshold: 20
    timeout_seconds: 60

  # Cache settings
  cache:
    schema_cache_ttl_seconds: 3600
    idempotency_cache_ttl_seconds: 3600
    routing_cache_ttl_seconds: 300

# Environment-specific overrides
environment_overrides:
  development:
    validation.enforce_schemas: false
    security.require_authentication: false
    observability.trace_sampling_rate: 1.0
    observability.log_level: "DEBUG"
    
  testing:
    dlq.enabled: false
    timeouts.publish_timeout_ms: 5000
    batching.adaptive_batching: false
    
  production:
    security.encrypt_sensitive_payloads: true
    security.audit_all_governance_events: true
    observability.trace_sampling_rate: 0.01
    circuit_breaker.failure_threshold_percent: 25