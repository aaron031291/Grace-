yh#!/usr/bin/env python3
"""Simple CLI for interacting with the Immutable Log API (local dev)."""
import sys
import requests
import json

API_BASE = "http://localhost:8000"


def cmd_append(path):
    data = json.load(sys.stdin) if not sys.stdin.isatty() else {}
    resp = requests.post(f"{API_BASE}/api/v1/logs", json=data)
    print(resp.status_code)
    print(resp.text)


def cmd_get(path):
    entry_cid = path
    resp = requests.get(f"{API_BASE}/api/v1/logs/{entry_cid}")
    print(resp.status_code)
    print(resp.text)


def cmd_search(path):
    data = json.load(sys.stdin) if not sys.stdin.isatty() else {"query": path}
    resp = requests.post(f"{API_BASE}/api/v1/logs/search", json=data)
    print(resp.status_code)
    print(resp.text)


def main():
    if len(sys.argv) < 3:
        print("usage: grace-log <append|get|search> <arg>")
        sys.exit(1)

    cmd = sys.argv[1]
    path = sys.argv[2]

    if cmd == "append":
        cmd_append(path)
    elif cmd == "get":
        cmd_get(path)
    elif cmd == "search":
        cmd_search(path)
    else:
        print("unknown command")


if __name__ == "__main__":
    main()
