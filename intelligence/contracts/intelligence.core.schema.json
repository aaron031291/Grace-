{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://grace.ai/schemas/intelligence/specialist-report/v1",
  "title": "Intelligence Specialist Report",
  "description": "Schema for specialist analysis reports",
  
  "SpecialistReport": {
    "type": "object",
    "required": ["report_id", "specialist", "candidates", "metrics", "risks", "timestamp"],
    "properties": {
      "report_id": {"type": "string"},
      "specialist": {
        "type": "string",
        "description": "e.g., 'Tabular-Classification'"
      },
      "candidates": {
        "type": "array",
        "items": {
          "type": "object",
          "required": ["model_key", "version", "artifact_uri"],
          "properties": {
            "model_key": {
              "type": "string",
              "description": "e.g., 'tabular.classification.xgb'"
            },
            "version": {"type": "string"},
            "artifact_uri": {"type": "string"},
            "est_latency_ms": {"type": "number"},
            "est_cost_units": {"type": "number"}
          }
        }
      },
      "metrics": {
        "type": "object",
        "description": "cross-validation evaluation metrics"
      },
      "uncertainties": {
        "type": "object",
        "description": "calibration, variance, entropy measures"
      },
      "explanations": {
        "type": "object",
        "description": "global/segment XAI results"
      },
      "risks": {
        "type": "array",
        "items": {"type": "string"},
        "description": "drift, bias, instability warnings"
      },
      "timestamp": {"type": "string", "format": "date-time"}
    }
  },

  "Plan": {
    "type": "object",
    "required": ["plan_id", "req_id", "route", "policy"],
    "properties": {
      "plan_id": {"type": "string"},
      "req_id": {"type": "string"},
      "route": {
        "type": "object",
        "properties": {
          "specialists": {
            "type": "array", 
            "items": {"type": "string"}
          },
          "models": {
            "type": "array", 
            "items": {"type": "string"},
            "description": "concrete model_keys"
          },
          "ensemble": {
            "type": "string",
            "enum": ["stack", "vote", "blend", "none"]
          },
          "canary_pct": {
            "type": "integer", 
            "minimum": 0, 
            "maximum": 100
          },
          "shadow": {"type": "boolean"}
        }
      },
      "policy": {
        "type": "object",
        "properties": {
          "min_confidence": {"type": "number"},
          "min_calibration": {"type": "number"},
          "fairness_delta_max": {"type": "number"},
          "log_level": {"enum": ["summary", "full"]}
        }
      }
    }
  },

  "InferenceResult": {
    "type": "object",
    "required": ["req_id", "outputs", "metrics", "lineage", "governance", "timing"],
    "properties": {
      "req_id": {"type": "string"},
      "outputs": {
        "type": "object",
        "properties": {
          "y_hat": {"description": "prediction output"},
          "proba": {"description": "probability estimates"},
          "top_k": {
            "type": "array",
            "items": {"type": "object"}
          },
          "actions": {
            "type": "array",
            "items": {"type": "string"},
            "description": "for RL tasks"
          }
        }
      },
      "metrics": {
        "type": "object",
        "description": "runtime calibration, confidence, drift checks"
      },
      "explanations": {
        "type": "object",
        "description": "optional per request"
      },
      "uncertainties": {"type": "object"},
      "lineage": {
        "type": "object",
        "properties": {
          "plan_id": {"type": "string"},
          "models": {
            "type": "array", 
            "items": {"type": "string"}
          },
          "ensemble": {"type": "string"},
          "feature_view": {"type": "string"}
        }
      },
      "governance": {
        "type": "object",
        "properties": {
          "approved": {"type": "boolean"},
          "policy_version": {"type": "string"},
          "redactions": {
            "type": "array", 
            "items": {"type": "string"}
          }
        }
      },
      "timing": {
        "type": "object",
        "properties": {
          "total_ms": {"type": "number"},
          "per_stage": {"type": "object"}
        }
      }
    }
  }
}