{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "interface.taskcard.schema.json",
  "title": "Interface TaskCard Schema",
  "description": "Task card data model for primary UX unit",
  "definitions": {
    "TaskCard": {
      "type": "object",
      "required": ["card_id", "title", "kind", "owner", "state", "created_at"],
      "properties": {
        "card_id": {
          "type": "string",
          "pattern": "card_[a-z0-9]{8,}"
        },
        "title": {"type": "string"},
        "kind": {
          "enum": ["analysis", "build", "ingest", "govern", "intel", "memory", "mlt", "debug"]
        },
        "owner": {"type": "string"},
        "state": {
          "enum": ["open", "running", "paused", "waiting_approval", "done", "failed"]
        },
        "context": {"type": "object"},
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "thread": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["msg_id", "author", "role", "at", "content"],
            "properties": {
              "msg_id": {"type": "string"},
              "role": {
                "enum": ["user", "grace", "specialist", "governance"]
              },
              "author": {"type": "string"},
              "at": {
                "type": "string",
                "format": "date-time"
              },
              "content": {"type": "object"}
            }
          }
        },
        "metrics": {
          "type": "object",
          "properties": {
            "latency_ms": {"type": "number"},
            "steps": {"type": "integer"}
          }
        },
        "approvals": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "ConsentRecord": {
      "type": "object",
      "required": ["consent_id", "user_id", "scope", "status", "created_at"],
      "properties": {
        "consent_id": {"type": "string"},
        "user_id": {"type": "string"},
        "scope": {
          "enum": ["autonomy", "pii_use", "external_share", "canary_participation"]
        },
        "status": {
          "enum": ["granted", "denied", "revoked", "pending"]
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "expires_at": {
          "type": "string",
          "format": "date-time",
          "nullable": true
        },
        "evidence_uri": {
          "type": "string",
          "nullable": true
        }
      }
    },
    "UIAction": {
      "type": "object",
      "required": ["action_id", "session_id", "type", "payload", "at"],
      "properties": {
        "action_id": {"type": "string"},
        "session_id": {"type": "string"},
        "type": {
          "enum": [
            "task.create", "task.update", "task.run", "task.pause", "task.cancel",
            "memory.search", "intel.request", "ingress.register_source",
            "governance.request_approval", "consent.grant", "consent.revoke",
            "settings.update", "snapshot.export", "snapshot.rollback"
          ]
        },
        "payload": {"type": "object"},
        "at": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "Notification": {
      "type": "object",
      "required": ["notif_id", "level", "message", "created_at"],
      "properties": {
        "notif_id": {"type": "string"},
        "level": {
          "enum": ["info", "success", "warning", "error"]
        },
        "message": {"type": "string"},
        "actions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "label": {"type": "string"},
              "action": {"type": "string"}
            }
          }
        },
        "read": {
          "type": "boolean",
          "default": false
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        }
      }
    }
  }
}