{
  "DatasetManifest": {
    "type": "object",
    "required": ["dataset_id", "task", "modality", "versions", "default_version"],
    "properties": {
      "dataset_id": {
        "type": "string",
        "pattern": "ds_[a-z0-9_-]{4,}"
      },
      "task": {
        "enum": ["classification", "regression", "clustering", "dimred", "rl", "nlp", "vision", "timeseries"]
      },
      "modality": {
        "enum": ["tabular", "text", "image", "audio", "video", "graph"]
      },
      "schema": {
        "type": "object"
      },
      "versions": {
        "type": "array",
        "items": {
          "type": "string"
        }
      },
      "default_version": {
        "type": "string"
      }
    }
  },
  "DatasetVersion": {
    "type": "object",
    "required": ["dataset_id", "version", "source_refs", "size", "stats", "splits", "feature_view"],
    "properties": {
      "dataset_id": {
        "type": "string"
      },
      "version": {
        "type": "string"
      },
      "source_refs": {
        "type": "array",
        "items": {
          "type": "string"
        }
      },
      "size": {
        "type": "object",
        "properties": {
          "rows": {
            "type": "integer"
          },
          "bytes": {
            "type": "integer"
          }
        }
      },
      "stats": {
        "type": "object"
      },
      "splits": {
        "type": "object",
        "properties": {
          "train": {
            "type": "number"
          },
          "valid": {
            "type": "number"
          },
          "test": {
            "type": "number"
          }
        }
      },
      "feature_view": {
        "type": "string"
      },
      "lineage_hash": {
        "type": "string"
      },
      "governance_label": {
        "enum": ["public", "internal", "restricted"]
      }
    }
  },
  "LabelTask": {
    "type": "object",
    "required": ["task_id", "dataset_id", "version", "policy_id", "items"],
    "properties": {
      "task_id": {
        "type": "string",
        "pattern": "lab_[a-z0-9]{6,}"
      },
      "dataset_id": {
        "type": "string"
      },
      "version": {
        "type": "string"
      },
      "policy_id": {
        "type": "string"
      },
      "assign": {
        "enum": ["auto", "round_robin", "skill_based"]
      },
      "items": {
        "type": "array",
        "items": {
          "type": "string"
        }
      },
      "priority": {
        "type": "string",
        "enum": ["low", "normal", "high", "critical"]
      }
    }
  },
  "Label": {
    "type": "object",
    "required": ["label_id", "task_id", "item_id", "annotator_id", "y", "quality", "at"],
    "properties": {
      "label_id": {
        "type": "string"
      },
      "task_id": {
        "type": "string"
      },
      "item_id": {
        "type": "string"
      },
      "annotator_id": {
        "type": "string"
      },
      "y": {},
      "evidence": {
        "type": "object"
      },
      "weak_sources": {
        "type": "array",
        "items": {
          "type": "string"
        }
      },
      "quality": {
        "type": "object",
        "properties": {
          "agreement": {
            "type": "number"
          },
          "gold_correct": {
            "type": "boolean"
          }
        }
      },
      "at": {
        "type": "string",
        "format": "date-time"
      }
    }
  },
  "LabelPolicy": {
    "type": "object",
    "required": ["policy_id", "rubric", "qa", "pii"],
    "properties": {
      "policy_id": {
        "type": "string"
      },
      "rubric": {
        "type": "object"
      },
      "qa": {
        "type": "object",
        "properties": {
          "gold_ratio": {
            "type": "number"
          },
          "dual_label_ratio": {
            "type": "number"
          },
          "min_agreement": {
            "type": "number"
          }
        }
      },
      "pii": {
        "type": "object",
        "properties": {
          "allow": {
            "type": "boolean"
          },
          "mask": {
            "type": "boolean"
          }
        }
      }
    }
  },
  "QueryConfig": {
    "type": "object",
    "required": ["strategy", "batch_size"],
    "properties": {
      "strategy": {
        "enum": ["uncertainty", "margin", "entropy", "diversity", "coresets", "hybrid"]
      },
      "batch_size": {
        "type": "integer"
      },
      "segment_filters": {
        "type": "object"
      },
      "min_confidence": {
        "type": "number"
      }
    }
  },
  "CurriculumSpec": {
    "type": "object",
    "required": ["spec_id", "objective", "rules"],
    "properties": {
      "spec_id": {
        "type": "string"
      },
      "objective": {
        "enum": ["improve_tail", "reduce_bias", "boost_calibration", "reduce_regret"]
      },
      "rules": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "select_slice": {
              "type": "string"
            },
            "difficulty": {
              "type": "number"
            },
            "min_samples": {
              "type": "integer"
            }
          }
        }
      }
    }
  },
  "AugmentSpec": {
    "type": "object",
    "required": ["spec_id", "modality", "ops"],
    "properties": {
      "spec_id": {
        "type": "string"
      },
      "modality": {
        "enum": ["text", "image", "audio", "tabular"]
      },
      "ops": {
        "type": "array",
        "items": {
          "oneOf": [
            {
              "type": "object",
              "properties": {
                "op": {
                  "const": "synonym_swap"
                },
                "prob": {
                  "type": "number"
                }
              }
            },
            {
              "type": "object",
              "properties": {
                "op": {
                  "const": "back_translate"
                },
                "lang": {
                  "type": "string"
                }
              }
            },
            {
              "type": "object",
              "properties": {
                "op": {
                  "const": "rand_crop"
                },
                "prob": {
                  "type": "number"
                }
              }
            },
            {
              "type": "object",
              "properties": {
                "op": {
                  "const": "noise_inject"
                },
                "std": {
                  "type": "number"
                }
              }
            },
            {
              "type": "object",
              "properties": {
                "op": {
                  "const": "mixup"
                },
                "alpha": {
                  "type": "number"
                }
              }
            }
          ]
        }
      }
    }
  },
  "LearningExperience": {
    "type": "object",
    "required": ["exp_id", "stage", "metrics", "timestamp"],
    "properties": {
      "exp_id": {
        "type": "string"
      },
      "stage": {
        "enum": ["labeling", "active_query", "weak_supervision", "augmentation", "curriculum", "version_publish", "eval"]
      },
      "metrics": {
        "type": "object",
        "properties": {
          "label_throughput_items_per_hr": {
            "type": "number"
          },
          "label_agreement": {
            "type": "number"
          },
          "gold_accuracy": {
            "type": "number"
          },
          "weak_precision": {
            "type": "number"
          },
          "query_gain_f1": {
            "type": "number"
          },
          "bias_delta": {
            "type": "number"
          },
          "leakage_flags": {
            "type": "integer"
          },
          "ds_drift_psi": {
            "type": "number"
          },
          "coverage": {
            "type": "number"
          }
        }
      },
      "segment": {
        "type": "string"
      },
      "timestamp": {
        "type": "string",
        "format": "date-time"
      }
    }
  }
}