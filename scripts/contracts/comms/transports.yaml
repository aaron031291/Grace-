kafka:
  topic_prefix: "grace."
  partitions_default: 6
  replication_factor: 3
  acks: "all"
  idempotency: true              # producer TXN
  max_message_bytes: 1048576     # 1MB
  
  headers_mapping:
    correlation_id: "x-correlation-id"
    traceparent:    "traceparent"
    tracestate:     "tracestate"
    priority:       "x-priority"
    qos:           "x-qos-class"
    
  topic_config:
    cleanup.policy: "compact,delete"
    retention.ms: 604800000      # 7 days
    min.insync.replicas: 2

nats:
  subject_prefix: "grace."
  queue_groups: true
  jetstream: 
    enabled: true
    retention: "limits"
    duplicates_window: "60m"
    max_age: "7d"
    
  clustering:
    enabled: true
    replicas: 3

amqp:
  exchange: "grace.bus"
  type: "topic"
  persistent: true
  routing_key_pattern: "grace.{domain}.{event}"
  
  queues:
    durable: true
    auto_delete: false
    exclusive: false

http:
  base_path: "/api/comms/v1"
  max_body_bytes: 1048576
  timeout_seconds: 30
  
  headers_passthrough: 
    - "traceparent"
    - "tracestate"
    - "x-correlation-id"
    - "x-priority"
    - "authorization"
    
  endpoints:
    publish: "POST /publish"
    query:   "GET /query"
    health:  "GET /health"

websocket:
  hubs:
    - "/ws/stream"
    - "/ws/notifications"
    
  message_envelope: "GME"
  max_connections: 1000
  ping_interval_seconds: 30
  
  # Auto-subscribe patterns for different user roles
  auto_subscribe:
    admin: ["grace.gov.*", "grace.res.*"]
    operator: ["grace.*.error", "grace.*.warning"]
    user: ["grace.ui.*"]

# Transport selection rules
selection_rules:
  - condition: "priority == 'P0' && qos == 'realtime'"
    transports: ["nats", "websocket"]
  - condition: "payload_size > 1MB"
    transports: ["kafka", "http"]
  - condition: "governance_label == 'restricted'"
    transports: ["kafka"]  # most secure option
  - condition: "default"
    transports: ["kafka", "nats", "http"]

# Load balancing
load_balancing:
  strategy: "round_robin"  # or "least_connections", "random", "hash"
  health_check_interval: 30
  failover_timeout: 5