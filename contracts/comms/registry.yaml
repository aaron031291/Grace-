registry:
  base_uri: "grace://contracts/"
  signing_required: true
  compatibility:
    default: "backward"        # old consumers keep working
    overrides:
      "intelligence.result": "full"
      "governance.decision": "forward"
      "mlt.experience": "none"
  
  negotiation:
    # allow kernels to advertise supported schema ranges
    advertise_header: "x-grace-schemas"
    format: "name@>=1.0.0 <2.0.0"
  
  validation:
    enforce_schema_refs: true
    allow_unknown_schemas: false
    cache_ttl_seconds: 3600

transforms:
  # on mismatch, dynamic adapter mapping
  - from: "intelligence.result@1.0"
    to:   "intelligence.result@1.1"
    adapter: "adapters/intel_result_10_to_11.py"
  - from: "governance.decision@1.0"
    to:   "governance.decision@1.1"
    adapter: "adapters/gov_decision_10_to_11.py"

# Schema evolution rules
evolution_rules:
  - name: "additive_fields_only"
    description: "Minor versions can only add optional fields"
    enforcement: "strict"
  - name: "no_field_removal"
    description: "Field removals require major version bump"
    enforcement: "strict"
  - name: "enum_extension"
    description: "Enums can be extended in minor versions"
    enforcement: "warn"

# Common type definitions that should be reused
common_types:
  id_patterns:
    correlation_id: "^cor_[a-z0-9_-]{6,}$"
    message_id: "^msg_[a-z0-9]{10,}$"
    experience_id: "^exp_[a-z0-9]{12}$"
    insight_id: "^ins_[a-z0-9]{12}$"
  
  timestamp_formats:
    iso8601: "date-time"
    unix_epoch: "integer"
  
  semver_pattern: "^[0-9]+\\.[0-9]+\\.[0-9]+$"
  
  hash_patterns:
    sha256: "^sha256:[a-f0-9]{64}$"
    sha512: "^sha512:[a-f0-9]{128}$"